.MODEL SMALL

.STACK 100H

.DATA

OUTMSG DB '...', 0AH, '$'
EXTRA DB '->', '$'
WAVE_SIZE DW 30
FILE_SIZE DW 3000
	
IMG_FNAME DB 'C:\GARDEN\IMAGES.TXT', 0
FILE_HANDLE DW 0
FILE_BUFFER DB 3000 DUP (?)
	
.CODE

JMP START

	;; AX -> f
	;; BX -> N
LOOP_PROC PROC NEAR
	PUSH CX
	MOV CX, 0
LP:
	ADD CX, 1
	CALL AX
	CMP CX, BX
	JNE LP
	POP CX
	RET
ENDP

	
	;; CX -> x
	;; DX -> y
WAVELET PROC NEAR
	PUSH AX
	MOV AH, 0CH
	MOV AL, AL
	INT 10H
	POP AX
	RET
ENDP

DELAY_PROC PROC NEAR
	PUSH AX
	PUSH CX
	PUSH DX
	MOV CX, 1
	MOV DX, 0H
	MOV AH, 86H
	INT 15H
	POP DX
	POP CX
	POP AX
	RET
ENDP

FILE_READ_PROC PROC NEAR
	PUSH AX
	PUSH BX
	PUSH CX
	PUSH DX

	MOV AH, 3DH
	MOV AL, 0
	MOV DX, OFFSET IMG_FNAME
	INT 21H
	MOV FILE_HANDLE, AX

	
	MOV AH, 3FH
	MOV CX, FILE_SIZE
	MOV DX, OFFSET FILE_BUFFER
	MOV BX, FILE_HANDLE
	INT 21H

	MOV BX, FILE_HANDLE	
	MOV AH,3EH
	INT 21H 

	MOV DX, OFFSET FILE_BUFFER
	ADD DX, AX
	MOV BX ,DX
	MOV [BX], '$'

	MOV DX, OFFSET FILE_BUFFER
	MOV AH, 9
	INT 21H
	
	POP DX
	POP CX
	POP BX
	POP AX
	RET
ENDP

DRAW_WAVE PROC NEAR
	PUSH AX
	PUSH BX
	MOV ES, CX
	MOV BX, 0
	PUSH CX
	PUSH DX
XLOOP: 
	MOV AX,0
	MOV CX, ES
YLOOP:
	CALL WAVELET
	
	INC CX
	INC AX
	CMP AX, 30
	JNE YLOOP
	
	INC DX
	INC BX
	CMP BX, 10
	JNE XLOOP

	;; CALL DELAY_PROC
	POP DX
	POP CX
	POP BX
	POP AX
	RET
ENDP
ENDP

START:
	MOV AX, 13H
	MOV AH, 0
	INT 10H
	
	MOV AX, @DATA 
	MOV DS, AX 
	MOV DX, OFFSET EXTRA	
	MOV AH, 9

	MOV CX, 100		
	MOV DX, 100

	;; JMP LOAD_RESOURCES
VIEW:
	MOV DX, CX
	CALL DRAW_WAVE
	SUB CX, 1
	CMP CX, 0
	JNE VIEW

LOAD_RESOURCES:	
	CALL FILE_READ_PROC

	;; MOV DS:DX
	
	MOV BX, OFFSET FILE_BUFFER
	MOV CL, [BX] 	
	ADD BX, 1
	MOV CH, [BX]	
	PUSH CX
	ADD BX, 1
	MOV CL, [BX] 	
	ADD BX, 1
	MOV CH, [BX]	

	;; DRAW POINT AT CL, CH
;; CYCLE THROUGH PICTURE OFF HT/WT ON STACK

	MOV AH, 0CH
	MOV AL, 88
	INT 10H
	POP AX

	MOV AX, OFFSET DRAW_WAVE
	MOV BX, 10000
	CALL LOOP_PROC
	
	;; JNE LOAD_IMGS
	;; CMP BX, 100		
	;; JNE LOAD_IMGS
 	
	MOV AL, 0 		
	MOV AH, 4CH
	INT 21H
END START

















